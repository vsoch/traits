<!DOCTYPE html>
<head>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

    <!--Select 2-->
    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
    
    <style>
 
      body {
          font-family: 'Roboto', sans-serif;
      }
      rect.bordered {
        stroke: #E6E6E6;
        stroke-width:2px;   
      }

      .container {
          padding: 20px;
          width: 1600px
      }

      text.mono {
        font-size: 9pt;
        font-family: 'Roboto', sans-serif lower-case;
        fill: #aaa;
      }

      text.yaxis {
        fill: #000;
      }

      text.xaxis {
        fill: #000;
      }

      footer {
          padding-left:20px;
          padding-bottom:10px;
      }

      .link {
          stroke: #ccc;
       }

      .node text {
          pointer-events: none;
          font: 10px sans-serif;
       }
    </style>
</head>
<meta charset="utf-8">

<body>
<div class="container" style="margin-left:5px;margin-right:5px">
    <div class="row">
       <div class="col-md-2" style="overflow:scroll; height:100vh">
          <!-- 
          <select id="termlist" style="width:300px; margin-bottom:10px">
              {% for behav,number,identifier,source in behaviors %}
              <option value="{{ identifier }}">{{ behav }}</option>
              {% endfor %}
           </select>-->
           <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
              {% for behav,number,identifier,source in behaviors %}
               <div id="id{{ identifier }}"></div>
               <div class="panel panel-default">
                   <div class="panel-heading" role="tab" id="heading{{ number }}">
                   <h4 class="panel-title">
                       <a role="button" data-toggle="collapse" data-parent="#accordion" href="#{{ identifier }}" aria-expanded="false" aria-controls="{{ identifier }}">{{ behav }}</a>
                   </h4>
                   </div>
                   <div id="{{ identifier }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{ number }}">
                       <div class="panel-body">
                       <a href="/download/{{ identifier }}">download</a> | <a href="/view/{{ identifier }}">view</a> | {{ source }}
                       </div>
                   </div>
              </div>
             {% endfor %}
           </div>


       </div>
       <div id="trait" class="col-md-8">
           <h1>{{ behavior }}</h1>
       </div>
       <div class="col-md-2">
           <h4>Definition</h4>
           <div class="well" id="definition">
           mouse over <img height="20px" src="http://png.findicons.com/files/icons/2770/ios_7_icons/128/brain_filled.png"/> for definition
           </div>
       </div>
    </div>
</div>


<script>

// D3

    var width = 800,
        height = 500

    var svg = d3.select("#trait").append("svg")
        .attr("width", width)
        .attr("height", height);

    var force = d3.layout.force()
        .gravity(.05)
        .distance(100)
        .charge(-100)
        .size([width, height]);

  var json = {{ prettyjson|safe }}

  // Check for undefined links
  json.links.forEach(function(link, index, list) {
      if (typeof json.nodes[link.source] === 'undefined') {
          console.log('undefined source', link);
      }
      if (typeof json.nodes[link.target] === 'undefined') {
          console.log('undefined target', link);
      }
  });

  force
      .nodes(json.nodes)
      .links(json.links)
      .start();

  var link = svg.selectAll(".link")
      .data(json.links)
    .enter().append("line")
      .attr("class", "link");

  var node = svg.selectAll(".node")
      .data(json.nodes)
    .enter().append("g")
      .attr("class", "node")
      .on("mouseover",function(d){
          if (d.definition!=""){
              $( "#definition" ).text(d.definition)
          } else {
              $( "#definition" ).text("undefined in WordNet")
          }
      })
      .call(force.drag);

  node.append("image")
      .attr("xlink:href", "http://png.findicons.com/files/icons/2770/ios_7_icons/128/brain_filled.png")
      .attr("x", -8)
      .attr("y", -8)
      .attr("width", 16)
      .attr("height", 16);

  node.append("text")
      .attr("dx", 12)
      .attr("dy", ".35em")
      .text(function(d) { return d.name })
      .on("mouseover",function(d){
          if (d.definition!=""){
              $( "#definition" ).text(d.definition)
          } else {
              $( "#definition" ).text("undefined in WordNet")
          }
      })

  force.on("tick", function() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
  });

// Select 2
//var termlist = $("#termlist").select2()
//$("#termlist").on("change", function(e) {
//    var theID = $(termlist).select2('data')[0].id;
//    jump("id" + theID)
//    var panel = $("#" + theID)
//    if (panel.hasClass("in")) {
//        panel.removeClass("in")
//    } else {
//        panel.addClass("in")
//    }
//})
//function jump(h){
//    var top = document.getElementById(h).screenY; 
//    document.getElementById(h).scrollTop += top;
//}
</script>

